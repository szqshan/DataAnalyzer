# 记忆管理功能快速设置指南

## 🚀 快速开始

### 1. 启动记忆管理服务

```bash
# 在项目根目录下运行
python start_memory_service.py
```

服务将启动在 `http://localhost:5002`

### 2. 设置API密钥

在前端测试页面 `test_frontend.html` 中：
1. 打开页面：`http://localhost:5000/test_frontend.html` (需要先启动主服务)
2. 在"用户信息设置"部分输入您的API密钥
3. 点击"设置用户信息"

### 3. 使用记忆管理功能

1. **创建或选择对话**：在"对话管理功能测试"部分创建新对话或切换到现有对话
2. **检查记忆服务**：在"记忆管理功能"部分点击"检查记忆服务"
3. **获取记忆统计**：点击"获取记忆统计"查看当前对话的token使用情况
4. **开始记忆分析**：点击"开始记忆分析"让AI分析并优化对话记忆

## 📋 服务状态检查

### 主服务（端口5000）
```bash
curl http://localhost:5000/api/health
```

### 记忆管理服务（端口5002）
```bash
curl http://localhost:5002/memory/health
```

## 🔧 环境变量配置

```bash
# 必需
export ANTHROPIC_API_KEY=sk-your-api-key-here

# 可选
export MEMORY_HOST=localhost
export MEMORY_PORT=5002
export MEMORY_DEBUG=False
```

## 🎯 功能特点

- ✅ **完全独立**：记忆管理服务独立运行，不影响主程序
- ✅ **前端集成**：在测试页面中直接使用记忆管理功能
- ✅ **实时反馈**：提供详细的分析日志和结果统计
- ✅ **安全可控**：支持确认机制和手动控制
- ✅ **智能优化**：AI自动识别冗余信息并生成记忆总结

## 🚨 故障排除

### 问题1：记忆服务连接失败
- 确认记忆管理服务已启动
- 检查端口5002是否被占用
- 查看服务启动日志

### 问题2：API密钥错误
- 确认已在前端设置有效的API密钥
- 检查API密钥格式是否正确
- 确认API密钥有足够的额度

### 问题3：找不到对话记录
- 确认已创建或选择了对话
- 检查用户数据目录权限
- 查看对话列表是否为空

## 📖 使用流程

1. **启动服务** → 运行 `python start_memory_service.py`
2. **打开前端** → 访问 `test_frontend.html`
3. **设置用户** → 输入用户信息和API密钥
4. **创建对话** → 在对话管理部分创建新对话
5. **进行对话** → 使用多轮对话功能进行数据分析
6. **检查记忆** → 在记忆管理部分查看统计信息
7. **优化记忆** → 点击"开始记忆分析"进行优化

## 💡 最佳实践

- 在对话消息较多（>20条）时使用记忆优化
- 定期检查token使用情况
- 保持重要的分析结果和结论
- 删除重复的确认和无效查询 