# æ™ºèƒ½æ•°æ®åº“åˆ†æç³»ç»Ÿ (DataAnalyzer)

ä¸€ä¸ªåŸºäºPython Flaskå’ŒAnthropic Claude AIçš„æ™ºèƒ½æ•°æ®åº“åˆ†æç³»ç»Ÿï¼Œæ”¯æŒCSVæ•°æ®å¯¼å…¥ã€AIæ™ºèƒ½åˆ†æã€å¤šè½®å¯¹è¯å’Œå†å²è®°å½•ç®¡ç†ã€‚

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

- ğŸ“Š **æ™ºèƒ½æ•°æ®åˆ†æ**ï¼šåŸºäºAnthropic Claude AIçš„æ™ºèƒ½æ•°æ®åˆ†æå’Œæ´å¯Ÿ
- ğŸ“ **CSVæ•°æ®å¯¼å…¥**ï¼šæ”¯æŒCSVæ–‡ä»¶ä¸Šä¼ å¹¶è‡ªåŠ¨å¯¼å…¥SQLiteæ•°æ®åº“
- ğŸ’¬ **å¤šè½®å¯¹è¯**ï¼šæ”¯æŒä¸AIè¿›è¡Œå¤šè½®å¯¹è¯ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿ç»­æ€§
- ğŸ“š **å¯¹è¯å†å²ç®¡ç†**ï¼šå®Œæ•´çš„å¯¹è¯å†å²è®°å½•å’Œç®¡ç†åŠŸèƒ½
- ğŸ‘¥ **å¤šç”¨æˆ·æ”¯æŒ**ï¼šæ”¯æŒå¤šç”¨æˆ·éš”ç¦»ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æ•°æ®ç©ºé—´
- ğŸ”„ **æµå¼å“åº”**ï¼šæ”¯æŒAIå“åº”çš„æµå¼è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- ğŸŒ **Webç•Œé¢**ï¼šæä¾›ç›´è§‚çš„Webæµ‹è¯•ç•Œé¢

## ğŸ“ é¡¹ç›®ç»“æ„

```
DataAnalyzer1.1/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app.py                 # Flaskä¸»åº”ç”¨æ–‡ä»¶
â”‚   â”œâ”€â”€ conversation_history.py # å¯¹è¯å†å²ç®¡ç†
â”‚   â”œâ”€â”€ datatest1_7_5.py       # æ•°æ®åˆ†ææ ¸å¿ƒ
â”‚   â”œâ”€â”€ user_middleware.py     # ç”¨æˆ·ç®¡ç†ä¸­é—´ä»¶
â”‚   â””â”€â”€ data/                  # åç«¯æ•°æ®ç›®å½•
â”œâ”€â”€ data/                      # ç”¨æˆ·æ•°æ®å­˜å‚¨ç›®å½•
â”œâ”€â”€ logs/                      # ç³»ç»Ÿæ—¥å¿—ç›®å½•
â”œâ”€â”€ test_frontend.html         # Webæµ‹è¯•ç•Œé¢
â”œâ”€â”€ start.py                   # ç³»ç»Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ .gitignore                # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.7+
- ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeç­‰ï¼‰
- Anthropic APIå¯†é’¥

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```env
# å¿…éœ€é…ç½®
ANTHROPIC_API_KEY=sk-your-api-key-here

# å¯é€‰é…ç½®
ANTHROPIC_BASE_URL=https://api.anthropic.com  # å¯é€‰ï¼Œè‡ªå®šä¹‰APIåœ°å€
HOST=0.0.0.0                                  # æœåŠ¡å™¨ä¸»æœºåœ°å€
PORT=5000                                     # æœåŠ¡å™¨ç«¯å£
```

### 4. å¯åŠ¨ç³»ç»Ÿ

```bash
python start.py
```

å¯åŠ¨åä¼šè‡ªåŠ¨ï¼š
- å¯åŠ¨Flaskåç«¯æœåŠ¡ï¼ˆhttp://localhost:5000ï¼‰
- æ‰“å¼€Webæµ‹è¯•ç•Œé¢ï¼ˆtest_frontend.htmlï¼‰

## ğŸ“¡ API æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `http://localhost:5000/api`
- **è®¤è¯æ–¹å¼**: ç”¨æˆ·IDå’Œç”¨æˆ·åï¼ˆé€šè¿‡è¯·æ±‚å¤´æˆ–å‚æ•°ä¼ é€’ï¼‰
- **æ•°æ®æ ¼å¼**: JSON
- **CORS**: æ”¯æŒè·¨åŸŸè¯·æ±‚

### ç”¨æˆ·è®¤è¯

æ‰€æœ‰APIæ¥å£éƒ½éœ€è¦ç”¨æˆ·èº«ä»½è¯†åˆ«ï¼Œæ”¯æŒä»¥ä¸‹æ–¹å¼ï¼š

#### 1. è¯·æ±‚å¤´æ–¹å¼ï¼ˆæ¨èï¼‰
```http
X-User-ID: your_user_id
X-Username: your_username
```

#### 2. URLå‚æ•°æ–¹å¼
```http
GET /api/status?userId=your_user_id&username=your_username
```

#### 3. è¯·æ±‚ä½“æ–¹å¼
```json
{
  "userId": "your_user_id",
  "username": "your_username",
  "query": "your_query"
}
```

### ç³»ç»ŸçŠ¶æ€æ¥å£

#### GET /api/health
å¥åº·æ£€æŸ¥æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T12:00:00Z"
}
```

#### GET /api/status
è·å–ç³»ç»ŸçŠ¶æ€ï¼ˆéœ€è¦è®¤è¯ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "system_ready": true,
  "database_connected": true,
  "database_path": "/path/to/user_db.db",
  "table_name": "data_table",
  "record_count": 1000,
  "api_status": "connected",
  "user_info": {
    "user_id": "user123",
    "username": "å¼ ä¸‰",
    "is_guest": false
  }
}
```

### æ•°æ®ç®¡ç†æ¥å£

#### POST /api/upload
ä¸Šä¼ CSVæ–‡ä»¶å¹¶å¯¼å…¥æ•°æ®åº“

**è¯·æ±‚æ ¼å¼ï¼š** `multipart/form-data`

**å‚æ•°ï¼š**
- `file`: CSVæ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
- `tableName`: è¡¨åï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º"data_table"ï¼‰
- `userId`: ç”¨æˆ·IDï¼ˆå¿…éœ€ï¼‰
- `username`: ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æˆåŠŸå¯¼å…¥ 1000 è¡Œæ•°æ®åˆ°è¡¨ 'data_table'",
  "data": {
    "rows_imported": 1000,
    "columns": ["id", "name", "age", "city"],
    "table_name": "data_table",
    "database_path": "/path/to/user_db.db"
  }
}
```

### æ•°æ®åˆ†ææ¥å£

#### POST /api/analyze-stream
æµå¼AIæ•°æ®åˆ†æ

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": "user123",
  "username": "å¼ ä¸‰",
  "query": "åˆ†æç”¨æˆ·å¹´é¾„åˆ†å¸ƒæƒ…å†µ"
}
```

**å“åº”æ ¼å¼ï¼š** `text/plain` (Server-Sent Events)

**å“åº”ç¤ºä¾‹ï¼š**
```
data: {"type": "status", "message": "å¼€å§‹åˆ†æ..."}

data: {"type": "progress", "step": "æ•°æ®æŸ¥è¯¢", "message": "æ­£åœ¨æŸ¥è¯¢æ•°æ®åº“..."}

data: {"type": "content", "content": "æ ¹æ®æ•°æ®åˆ†æï¼Œç”¨æˆ·å¹´é¾„åˆ†å¸ƒå¦‚ä¸‹ï¼š"}

data: {"type": "complete", "conversation_id": "conv_20240101_120000_001"}
```

### å¯¹è¯ç®¡ç†æ¥å£

#### POST /api/conversations/create
åˆ›å»ºæ–°å¯¹è¯

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": "user123",
  "username": "å¼ ä¸‰",
  "conversation_name": "æ•°æ®åˆ†æå¯¹è¯",
  "description": "å…³äºç”¨æˆ·æ•°æ®çš„åˆ†æå¯¹è¯"
}
```

#### GET /api/conversations/list
è·å–ç”¨æˆ·å¯¹è¯åˆ—è¡¨

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "conversations": [
    {
      "conversation_id": "conv_20240101_120000_001",
      "conversation_name": "æ•°æ®åˆ†æå¯¹è¯",
      "description": "å…³äºç”¨æˆ·æ•°æ®çš„åˆ†æå¯¹è¯",
      "created_time": "2024-01-01T12:00:00Z",
      "last_activity": "2024-01-01T12:30:00Z",
      "status": "active",
      "message_count": 5,
      "user_id": "user123",
      "username": "å¼ ä¸‰"
    }
  ]
}
```

#### POST /api/conversations/switch
åˆ‡æ¢å½“å‰å¯¹è¯

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": "user123",
  "conversation_id": "conv_20240101_120000_001"
}
```

#### GET /api/conversations/current
è·å–å½“å‰å¯¹è¯ä¿¡æ¯

#### GET /api/conversations
è·å–å¯¹è¯å†å²ï¼ˆæ”¯æŒåˆ†é¡µï¼‰

**å‚æ•°ï¼š**
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
- `offset`: åç§»é‡ï¼ˆé»˜è®¤0ï¼‰

#### GET /api/conversations/{conversation_id}
è·å–ç‰¹å®šå¯¹è¯è¯¦æƒ…

#### DELETE /api/conversations/{conversation_id}
åˆ é™¤å¯¹è¯

#### GET /api/conversations/recent
è·å–æœ€è¿‘å¯¹è¯åˆ—è¡¨

**å‚æ•°ï¼š**
- `limit`: æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤5ï¼‰

#### GET /api/conversations/stats
è·å–å¯¹è¯ç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "stats": {
    "total_conversations": 10,
    "active_conversations": 8,
    "total_messages": 150,
    "avg_messages_per_conversation": 15.0,
    "most_active_day": "2024-01-01",
    "recent_activity": "2024-01-01T12:30:00Z"
  }
}
```

### æ¶ˆæ¯ç®¡ç†æ¥å£

#### POST /api/conversations/{conversation_id}/messages/{message_id}/edit
ç¼–è¾‘æ¶ˆæ¯

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": "user123",
  "new_content": "ä¿®æ”¹åçš„æ¶ˆæ¯å†…å®¹"
}
```

#### POST /api/conversations/{conversation_id}/messages/{message_id}/delete
åˆ é™¤æ¶ˆæ¯

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": "user123"
}
```

## ğŸš¨ å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 1. å‰ç«¯ç•Œé¢é—®é¢˜
- **å“åº”å¼è®¾è®¡ç¼ºå¤±**ï¼šå‰ç«¯é¡µé¢ä¸èƒ½è‡ªé€‚åº”ä¸åŒçª—å£å¤§å°
- **ç§»åŠ¨ç«¯æ”¯æŒä¸è¶³**ï¼šåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤ºæ•ˆæœä¸ä½³
- **UI/UXå¾…ä¼˜åŒ–**ï¼šç•Œé¢è®¾è®¡è¾ƒä¸ºç®€å•ï¼Œç”¨æˆ·ä½“éªŒæœ‰å¾…æå‡

### 2. æ€§èƒ½å’Œç¨³å®šæ€§
- **å¤§æ–‡ä»¶å¤„ç†**ï¼šå¤„ç†è¶…å¤§CSVæ–‡ä»¶æ—¶å¯èƒ½å‡ºç°å†…å­˜ä¸è¶³
- **å¹¶å‘é™åˆ¶**ï¼šé«˜å¹¶å‘æƒ…å†µä¸‹å¯èƒ½å‡ºç°æ•°æ®åº“é”å®šé—®é¢˜
- **é”™è¯¯æ¢å¤**ï¼šç³»ç»Ÿå¼‚å¸¸åçš„è‡ªåŠ¨æ¢å¤æœºåˆ¶ä¸å®Œå–„

### 3. åŠŸèƒ½é™åˆ¶
- **æ•°æ®æ ¼å¼æ”¯æŒ**ï¼šç›®å‰åªæ”¯æŒCSVæ ¼å¼ï¼Œä¸æ”¯æŒExcelã€JSONç­‰æ ¼å¼
- **æ•°æ®åº“ç±»å‹**ï¼šåªæ”¯æŒSQLiteï¼Œä¸æ”¯æŒMySQLã€PostgreSQLç­‰
- **AIæ¨¡å‹é™åˆ¶**ï¼šä¾èµ–Anthropic Claude APIï¼Œå—APIé™åˆ¶å½±å“

### 4. å®‰å…¨æ€§é—®é¢˜
- **ç”¨æˆ·è®¤è¯**ï¼šç”¨æˆ·è®¤è¯æœºåˆ¶è¾ƒä¸ºç®€å•ï¼Œç¼ºä¹ä¸¥æ ¼çš„æƒé™æ§åˆ¶
- **æ•°æ®éš”ç¦»**ï¼šè™½ç„¶æ”¯æŒå¤šç”¨æˆ·ï¼Œä½†æ•°æ®éš”ç¦»æœºåˆ¶éœ€è¦åŠ å¼º
- **APIå®‰å…¨**ï¼šç¼ºä¹APIé€Ÿç‡é™åˆ¶å’Œé˜²æŠ¤æœºåˆ¶

### 5. å¤šç”¨æˆ·ç³»ç»Ÿé—®é¢˜
- **ç”¨æˆ·IDä¾èµ–**ï¼šç³»ç»Ÿæ­£å¸¸è¿è¡Œéœ€è¦æä¾›æœ‰æ•ˆçš„ç”¨æˆ·ID
- **è®¿å®¢æ¨¡å¼é™åˆ¶**ï¼šè®¿å®¢æ¨¡å¼åŠŸèƒ½æœ‰é™ï¼Œå»ºè®®æ³¨å†Œæ­£å¼ç”¨æˆ·
- **æ•°æ®æŒä¹…åŒ–**ï¼šç”¨æˆ·æ•°æ®ä¾èµ–æœ¬åœ°å­˜å‚¨ï¼Œç¼ºä¹äº‘ç«¯å¤‡ä»½

### 6. AIåˆ†æå‡†ç¡®æ€§
- **æç¤ºè¯ä¼˜åŒ–**ï¼šAIåˆ†æçš„å‡†ç¡®æ€§ä¾èµ–ç³»ç»Ÿæç¤ºè¯ï¼Œéœ€è¦æŒç»­ä¼˜åŒ–
- **ä¸Šä¸‹æ–‡ç†è§£**ï¼šå¤æ‚æŸ¥è¯¢çš„ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›æœ‰é™
- **ç»“æœéªŒè¯**ï¼šAIåˆ†æç»“æœç¼ºä¹è‡ªåŠ¨éªŒè¯æœºåˆ¶

## ğŸ”§ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/szqshan/DataAnalyzer.git
cd DataAnalyzer
```

2. **å®‰è£…å¼€å‘ä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **é…ç½®å¼€å‘ç¯å¢ƒ**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„APIå¯†é’¥
```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
python start.py
```

### é¡¹ç›®æ¶æ„

- **å‰åç«¯åˆ†ç¦»**ï¼šå‰ç«¯ä½¿ç”¨åŸç”ŸHTML/JSï¼Œåç«¯ä½¿ç”¨Flask
- **ç”¨æˆ·éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æ•°æ®åº“å’Œå­˜å‚¨ç©ºé—´
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•

### æ·»åŠ æ–°åŠŸèƒ½

1. **åç«¯API**ï¼šåœ¨ `backend/app.py` ä¸­æ·»åŠ æ–°çš„è·¯ç”±
2. **æ•°æ®å¤„ç†**ï¼šåœ¨ `backend/datatest1_7_5.py` ä¸­æ·»åŠ æ–°çš„åˆ†æåŠŸèƒ½
3. **å‰ç«¯ç•Œé¢**ï¼šåœ¨ `test_frontend.html` ä¸­æ·»åŠ æ–°çš„UIç»„ä»¶

## ğŸ“‹ å¾…åŠäº‹é¡¹

### é«˜ä¼˜å…ˆçº§
- [ ] ä¿®å¤å‰ç«¯å“åº”å¼è®¾è®¡é—®é¢˜
- [ ] ä¼˜åŒ–å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½
- [ ] åŠ å¼ºç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- [ ] æ·»åŠ æ•°æ®æ ¼å¼æ”¯æŒï¼ˆExcelã€JSONç­‰ï¼‰

### ä¸­ä¼˜å…ˆçº§
- [ ] å®ç°äº‘ç«¯æ•°æ®å¤‡ä»½
- [ ] æ·»åŠ APIé€Ÿç‡é™åˆ¶
- [ ] ä¼˜åŒ–AIæç¤ºè¯å’Œåˆ†æå‡†ç¡®æ€§
- [ ] æ·»åŠ æ•°æ®å¯è§†åŒ–åŠŸèƒ½

### ä½ä¼˜å…ˆçº§
- [ ] æ”¯æŒæ›´å¤šæ•°æ®åº“ç±»å‹
- [ ] æ·»åŠ ç”¨æˆ·ç®¡ç†åå°
- [ ] å®ç°æ’ä»¶ç³»ç»Ÿ
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add some AmazingFeature'`
4. æ¨é€åˆ°åˆ†æ”¯ï¼š`git push origin feature/AmazingFeature`
5. åˆ›å»ºPull Request

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **é¡¹ç›®åœ°å€**ï¼šhttps://github.com/szqshan/DataAnalyzer
- **é—®é¢˜åé¦ˆ**ï¼šhttps://github.com/szqshan/DataAnalyzer/issues
- **ä½œè€…**ï¼šå±±å¿—å¼º (szqshan)

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ MIT åè®® - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

- [Anthropic](https://www.anthropic.com/) - æä¾›å¼ºå¤§çš„Claude AI API
- [Flask](https://flask.palletsprojects.com/) - ä¼˜ç§€çš„Python Webæ¡†æ¶
- [Pandas](https://pandas.pydata.org/) - å¼ºå¤§çš„æ•°æ®å¤„ç†åº“

---

**ç‰ˆæœ¬ä¿¡æ¯**ï¼šv1.1.2
**æœ€åæ›´æ–°**ï¼š2024å¹´1æœˆ
**å…¼å®¹æ€§**ï¼šPython 3.7+ 